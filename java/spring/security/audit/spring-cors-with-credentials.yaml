rules:
- id: spring-cors-with-credentials
  message: |
    Cross-Origin Resource Sharing with credentials is enabled. This is a security risk.
  metadata:
    cwe: "CWE-284: Improper Access Control"
    owasp: 'A5 - Broken Access Control'
  severity: WARNING
  languages: [java]
  pattern-either:
  - patterns:
    - pattern-not: |
        @org.springframework.web.bind.annotation.CrossOrigin(..., origins = "=~/^[^*].*$/", ...)
    - pattern: |
        @org.springframework.web.bind.annotation.CrossOrigin(..., allowCredentials = "true", ...)

- id: global-spring-cors-with-credentials
  message: |
    Cross-Origin Resource Sharing with credentials is enabled. This is a security risk.
  metadata:
    cwe: "CWE-284: Improper Access Control"
    owasp: 'A5 - Broken Access Control'
  severity: WARNING
  languages: [java]
  pattern-either:
  - patterns:
    - pattern-inside: |
        $RETURN $METHOD(..., CorsRegistry $R, ...) {
          ...
        }
    - pattern-inside: |
        <... $M.allowCredentials(true) ...>
    - pattern-inside: |
        <... $MP.allowedOrigins(..., "*", ...) ...>
  - patterns:
    - pattern-inside: |
        $RETURN $METHOD(..., CorsRegistry $R, ...) {
          ...
        }
    - pattern-inside: |
        <... $M.allowCredentials(true) ...>
    - pattern-not-inside: |
        <... $MP.allowedOrigins(...) ...>

- id: spring-security-cors-with-credentials
  message: |
    Cross-Origin Resource Sharing with credentials is enabled. This is a security risk.
  metadata:
    cwe: "CWE-284: Improper Access Control"
    owasp: 'A5 - Broken Access Control'
  severity: WARNING
  languages: [java]
  patterns:
  - pattern: |
      $CORS_CONFIG = new CorsConfiguration(...);
      ...
      $CORS_CONFIG.setAllowCredentials(true);
      ...

